import{u as t,o as e,c as i,w as a,a as s,b as o,j as n,C as l,i as r,z as d,x as c,N as h,P as u,O as p,y as m,t as g,v as f,d as y,k as _,n as b,R as x,T as k,h as T}from"./index-CE7gXyKD.js";import{r as I,_ as S}from"./watermark.Dpp_Cumi.js";import{_ as w}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as v}from"./top-right-tool-wx.D2Qxchdl.js";const C=w({components:{openTool:w({data:()=>({show:!1,animationData:{}}),props:{data:{type:[Object,String]},itemKey:{type:[Object,String,Number]},list:{type:Array,default:()=>[{}]}},onShow(){},computed:{chatList(){return this.$store.state.chatlist}},mounted(){var e=t({duration:300,timingFunction:"linear"});this.animation=e},methods:{zhiding(){var t=JSON.parse(JSON.stringify(this.data)),e="N"==t.top?"Y":"N";if(t.top=e,this.$store.dispatch("updateChatListInfoById",{userId:this.data.userId,data:t}),this.$store.dispatch("getChatList"),"GROUP"==t.windowType){var i={groupId:this.data.userId,top:e};this.$http.request({url:"/group/editTop",method:"POST",data:JSON.stringify(i),success:t=>{t.data.code}})}if("SINGLE"==t.windowType){i={userId:this.data.userId,top:e};this.$http.request({url:"/friend/top",method:"POST",data:JSON.stringify(i),success:t=>{t.data.code}})}},shanchu(){delete this.chatList[this.data.userId],this.$store.dispatch("updateChatListInfoById",{userId:this.data.userId,data:{}}),this.$store.dispatch("updateChatById",{userId:this.data.userId,data:[]})},showAnimation(){this.animation.opacity(1).step(),this.animationData=this.animation.export()},hideAnimation(){this.animation.opacity(0).step(),this.animationData=this.animation.export()},moveHandle(t){this.hiddenTab()},showTab(){this.show=!0,setTimeout((()=>{this.showAnimation()}),30)},hiddenTab(){this.show=!1,this.hideAnimation()}}},[["render",function(t,d,c,h,u,p){const m=r;return u.show?(e(),i(m,{key:0,onTouchmove:d[0]||(d[0]=l((t=>p.moveHandle("touchmove")),["stop","prevent"])),onClick:d[1]||(d[1]=t=>p.moveHandle("click"))},{default:a((()=>[s(m,{class:"openTool-wx",animation:u.animationData},{default:a((()=>[c.data?(e(),i(m,{key:0,class:"openTool-wx-list"},{default:a((()=>[s(m,{class:"openTool-wx-list-item",onClick:p.zhiding},{default:a((()=>["Y"==c.data.top?(e(),i(m,{key:0,class:"text"},{default:a((()=>[o("取消置顶")])),_:1})):n("",!0),"N"==c.data.top?(e(),i(m,{key:1,class:"text"},{default:a((()=>[o("置顶该聊天")])),_:1})):n("",!0)])),_:1},8,["onClick"]),s(m,{class:"openTool-wx-list-item",onClick:p.shanchu},{default:a((()=>[s(m,{class:"text"},{default:a((()=>[o("删除该聊天")])),_:1})])),_:1},8,["onClick"])])),_:1})):n("",!0)])),_:1},8,["animation"]),s(m,{class:"openTool-wx-model"})])),_:1})):n("",!0)}],["__scopeId","data-v-9f329c31"]])},name:"UniListChatWx",emits:["click","longpressItem"],props:{color:{type:String,default:"#fff"},title:{type:String,default:""},note:{type:String,default:""},clickable:{type:Boolean,default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},badgeText:{type:[String,Number],default:""},badgePositon:{type:String,default:"right"},time:{type:String,default:""},avatarCircle:{type:Boolean,default:!1},avatar:{type:String,default:""},item:{type:Object,default:{}},itemKey:{type:Number},longTapItemKey:{type:[Number,String],default:""}},computed:{isSingle(){if("dot"===this.badgeText)return"uni-badge--dot";return this.badgeText.toString().length>1?"uni-badge--complex":"uni-badge--single"},avatarList(){return this.returnAvatar(this.item.portrait)},computedAvatar(){return this.avatarList.length>4?(this.imageWidth=13.95,"avatarItem--3"):this.avatarList.length>1?(this.imageWidth=21.15,"avatarItem--2"):(this.imageWidth=45,"avatarItem--1")}},data:()=>({isFirstChild:!1,border:!0,imageWidth:50}),mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0),this.border=this.list.border)},methods:{returnAvatar(t){for(var e=JSON.parse(t),i=[],a=0;a<e.length;a++)i.push({url:e[a]});return i},longpressItem(t,e,i){this.$emit("longpressItem",t,e,i),this.itemKey==this.longTapItemKey&&this.$refs["toolx"+this.itemKey].showTab()},getForm(t="uniList"){let e=this.$parent,i=e.$options.name;for(;i!==t;){if(e=e.$parent,!e)return!1;i=e.$options.name}return e},onClick(){""===this.to?(this.clickable||this.link)&&this.$emit("click",{data:{}}):this.openPage()},openPage(){-1!==["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(t){uni[t]({url:this.to,success:t=>{this.$emit("click",{data:t})},fail:t=>{this.$emit("click",{data:t}),console.error(t.errMsg)}})}}},[["render",function(t,l,b,x,k,T){const I=d("openTool"),S=r,w=y,v=_;return e(),i(S,{"hover-class":b.clickable||b.link?"uni-list-chat--hover":"",style:m({background:b.color}),class:"uni-list-chat",onLongpress:l[0]||(l[0]=t=>T.longpressItem(t,b.itemKey,b.item))},{default:a((()=>[s(I,{class:"openTool",ref:"toolx"+b.itemKey,data:b.item,itemKey:b.itemKey},null,8,["data","itemKey"]),s(S,{class:c({"uni-list--border":k.border,"uni-list-chat--first":k.isFirstChild})},null,8,["class"]),s(S,{class:"uni-list-chat__container",onClick:T.onClick},{default:a((()=>[s(S,{class:"uni-list-chat__header-warp"},{default:a((()=>["SINGLE"==b.item.windowType?(e(),i(S,{key:0,class:c(["uni-list-chat__header",{"header--circle":b.avatarCircle}])},{default:a((()=>[s(w,{class:"uni-list-chat__header-image",src:b.item.portrait,mode:"aspectFill"},null,8,["src"])])),_:1},8,["class"])):n("",!0),"GROUP"==b.item.windowType?(e(),i(S,{key:1,class:"uni-list-chat__header"},{default:a((()=>[(e(!0),h(u,null,p(T.avatarList,((t,o)=>(e(),i(S,{key:o,class:c(["uni-list-chat__header-box",T.computedAvatar]),style:m({width:k.imageWidth+"px",height:k.imageWidth+"px"})},{default:a((()=>[s(w,{class:"uni-list-chat__header-image",style:m({width:k.imageWidth+"px",height:k.imageWidth+"px"}),src:t.url,mode:"aspectFill"},null,8,["style","src"])])),_:2},1032,["class","style"])))),128))])),_:1})):n("",!0)])),_:1}),b.badgeText&&"left"===b.badgePositon?(e(),i(S,{key:0,class:c(["uni-list-chat__badge uni-list-chat__badge-pos",[T.isSingle]])},{default:a((()=>[s(v,{class:"uni-list-chat__badge-text"},{default:a((()=>[o(g("dot"===b.badgeText?"":b.badgeText),1)])),_:1})])),_:1},8,["class"])):n("",!0),s(S,{class:"uni-list-chat__content"},{default:a((()=>[s(S,{class:"uni-list-chat__content-main"},{default:a((()=>[s(v,{class:"uni-list-chat__content-title uni-ellipsis"},{default:a((()=>[o(g(b.title),1)])),_:1}),s(v,{class:"uni-list-chat__content-note uni-ellipsis"},{default:a((()=>[o(g(b.note),1)])),_:1})])),_:1}),s(S,{class:"uni-list-chat__content-extra"},{default:a((()=>[f(t.$slots,"default",{},(()=>[s(v,{class:"uni-list-chat__content-extra-text"},{default:a((()=>[o(g(b.time),1)])),_:1}),b.badgeText&&"right"===b.badgePositon?(e(),i(S,{key:0,class:c(["uni-list-chat__badge",[T.isSingle,"right"===b.badgePositon?"uni-list-chat--right":""]])},{default:a((()=>[s(v,{class:"uni-list-chat__badge-text"},{default:a((()=>[o(g("dot"===b.badgeText?"":b.badgeText),1)])),_:1})])),_:1},8,["class"])):n("",!0)]),!0)])),_:3})])),_:3})])),_:3},8,["onClick"])])),_:3},8,["hover-class","style"])}],["__scopeId","data-v-399951cd"]]);const N=w({name:"uniListWx","mp-weixin":{options:{multipleSlots:!1}},props:{enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0}},created(){this.firstChildAppend=!1},methods:{loadMore(t){this.$emit("scrolltolower")}}},[["render",function(t,s,o,l,d,c){const h=r;return e(),i(h,{class:"uni-list uni-border-top-bottom"},{default:a((()=>[o.border?(e(),i(h,{key:0,class:"uni-list--border-top"})):n("",!0),f(t.$slots,"default",{},void 0,!0),o.border?(e(),i(h,{key:1,class:"uni-list--border-bottom"})):n("",!0)])),_:3})}],["__scopeId","data-v-f37c41c2"]]);const $=w({data:()=>({longTapItemKey:0,tranMsg:"",list:[],toplist:[],NOTtoplist:[],clickToSubmitSure:null}),computed:{userInfo(){return this.$store.state.userInfo},chatlist(){return this.$store.state.chatlist},chatlistkeys(){return Object.keys(this.chatlist)},chatListNum(){return this.$store.state.chatListNum},topicReply(){return this.$store.state.topicReply},friendApply(){return this.$store.state.friendApply}},onLoad(){this.clickToSubmitSure=this.$fc.debounce((t=>{b({url:"../chatWindow/index?data="+encodeURIComponent(JSON.stringify(t))})}),1e3,!0)},watch:{chatListNum:{deep:!0,immediate:!1,handler(t){t>0?x({index:0,text:t.toString()}):k({index:0})}},topicReply:{deep:!0,immediate:!1,handler(t){t.count&&t.count>0?x({index:2,text:t.count.toString()}):k({index:2})}},friendApply:{deep:!0,immediate:!1,handler(t){t.count&&t.count>0?x({index:1,text:t.count.toString()}):k({index:1})}},chatlist:{deep:!0,immediate:!1,handler(t){var e=JSON.parse(JSON.stringify(t)),i=[],a=[],s=[];for(var o in e)e[o].xtime=new Date(e[o].time).getTime().toString(),e[o].userId&&i.push(e[o]),e[o].userId&&"Y"==e[o].top&&a.push(e[o]),e[o].userId&&"N"==e[o].top&&s.push(e[o]);i.sort(((t,e)=>e.xtime-t.xtime)),a.sort(((t,e)=>e.xtime-t.xtime)),s.sort(((t,e)=>e.xtime-t.xtime)),this.list=i,this.toplist=a,this.NOTtoplist=s}}},onShow(){this.$store.dispatch("tabBarpull")},mounted(){},methods:{longpressItem(t,e,i){this.longTapItemKey=e},returnAvatar(t){for(var e=JSON.parse(t),i=[],a=0;a<e.length;a++)i.push({url:e[a]});return i},clickChat(t){this.clickToSubmitSure(t)}},onNavigationBarButtonTap(t){switch(t.index){case 0:this.$refs.trtw.showTab();break;case 1:b({url:"../search/index"})}}},[["render",function(t,l,d,c,m,g){const f=I(T("watermark"),S),y=r,_=I(T("uni-list-chat-wx"),C),b=I(T("uni-list-wx"),N),x=I(T("top-right-tool-wx"),v);return e(),i(y,null,{default:a((()=>[s(f),s(b,null,{default:a((()=>[s(b,{border:!0},{default:a((()=>[m.list.length<=0?(e(),i(y,{key:0,class:"alertTips"},{default:a((()=>[o("暂无消息,快去联系你的好朋友吧")])),_:1})):n("",!0),(e(!0),h(u,null,p(m.toplist,((t,a)=>(e(),i(_,{key:a,color:"#eeeeee",itemKey:a,item:t,onLongpressItem:g.longpressItem,longTapItemKey:m.longTapItemKey,onClick:e=>g.clickChat(t),clickable:"",title:t.nickName,note:t.content,time:t.time,"badge-positon":"left","badge-text":t.num},null,8,["itemKey","item","onLongpressItem","longTapItemKey","onClick","title","note","time","badge-text"])))),128)),(e(!0),h(u,null,p(m.NOTtoplist,((t,a)=>(e(),i(_,{key:a,color:"#fff",itemKey:a,item:t,onLongpressItem:g.longpressItem,longTapItemKey:m.longTapItemKey,onClick:e=>g.clickChat(t),clickable:"",title:t.nickName,note:t.content,time:t.time,"badge-positon":"left","badge-text":t.num},null,8,["itemKey","item","onLongpressItem","longTapItemKey","onClick","title","note","time","badge-text"])))),128))])),_:1})])),_:1}),s(x,{ref:"trtw"},null,512)])),_:1})}],["__scopeId","data-v-99e66701"]]);export{$ as default};
