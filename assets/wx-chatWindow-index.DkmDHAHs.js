import{u as t,o as e,c as s,w as i,v as o,x as a,y as n,j as l,i as r,h as c,z as d,a as h,A as u,B as m,s as p,b as f,C as k,f as g,D as y,n as T,E as w,F as C,t as b,d as I,k as _,G as x,H as D,J as S,K as $,L as O,M as v,q as A,N as z,O as N,P as E,S as R,Q as P}from"./index-CE7gXyKD.js";import{r as V,_ as L}from"./watermark.Dpp_Cumi.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as B}from"./zmm-upload-image.CstjoT4s.js";import{_ as M,f as H}from"./index.AWQwckKq.js";import{_ as K}from"./uni-indexed-list-wx.Y7FQckb4.js";import"./uni-icons.tBNBx2EM.js";import"./bf.BE2RdUDc.js";import"./uni-load-more.BYiGPlg5.js";import"./uni-badge.BSmtmuwp.js";class F{constructor(e,s){this.options=e,this.animation=t(e),this.currentStepAnimates={},this.next=0,this.$=s}_nvuePushAnimates(t,e){let s=this.currentStepAnimates[this.next],i={};if(i=s||{styles:{},config:{}},J.includes(t)){i.styles.transform||(i.styles.transform="");let s="";"rotate"===t&&(s="deg"),i.styles.transform+=`${t}(${e+s}) `}else i.styles[t]=`${e}`;this.currentStepAnimates[this.next]=i}_animateRun(t={},e={}){let s=this.$.$refs.ani.ref;if(s)return new Promise(((i,o)=>{nvueAnimation.transition(s,{styles:t,...e},(t=>{i()}))}))}_nvueNextAnimate(t,e=0,s){let i=t[e];if(i){let{styles:o,config:a}=i;this._animateRun(o,a).then((()=>{e+=1,this._nvueNextAnimate(t,e,s)}))}else this.currentStepAnimates={},"function"==typeof s&&s(),this.isEnd=!0}step(t={}){return this.animation.step(t),this}run(t){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof t&&t()}),this.$.durationTime)}}const J=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function U(t,e){if(e)return clearTimeout(e.timer),new F(t,e)}J.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((t=>{F.prototype[t]=function(...e){return this.animation[t](...e),this}}));const X=j({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(t){t?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let t={...this.styles,"transition-duration":this.duration/1e3+"s"},e="";for(let s in t){e+=this.toLine(s)+":"+t[s]+";"}return e},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(t={}){t.duration&&(this.durationTime=t.duration),this.animation=U(Object.assign(this.config,t),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(t,e={}){if(this.animation){for(let e in t)try{"object"==typeof t[e]?this.animation[e](...t[e]):this.animation[e](t[e])}catch(s){console.error(`方法 ${e} 不存在`)}return this.animation.step(e),this}},run(t){this.animation&&this.animation.run(t)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:t,transform:e}=this.styleInit(!1);void 0!==t&&(this.opacity=t),this.transform=e,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=U(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(t){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:t,transform:e}=this.styleInit(!1);this.opacity=t||1,this.transform=e,this.$emit("change",{detail:this.isShow})}))},styleInit(t){let e={transform:""},s=(t,s)=>{"fade"===s?e.opacity=this.animationType(t)[s]:e.transform+=this.animationType(t)[s]+" "};return"string"==typeof this.modeClass?s(t,this.modeClass):this.modeClass.forEach((e=>{s(t,e)})),e},tranfromInit(t){let e=(t,e)=>{let s=null;"fade"===e?s=t?0:1:(s=t?"-100%":"0","zoom-in"===e&&(s=t?.8:1),"zoom-out"===e&&(s=t?1.2:1),"slide-right"===e&&(s=t?"100%":"0"),"slide-bottom"===e&&(s=t?"100%":"0")),this.animation[this.animationMode()[e]](s)};return"string"==typeof this.modeClass?e(t,this.modeClass):this.modeClass.forEach((s=>{e(t,s)})),this.animation},animationType:t=>({fade:t?1:0,"slide-top":`translateY(${t?"0":"-100%"})`,"slide-right":`translateX(${t?"0":"100%"})`,"slide-bottom":`translateY(${t?"0":"100%"})`,"slide-left":`translateX(${t?"0":"-100%"})`,"zoom-in":`scaleX(${t?1:.8}) scaleY(${t?1:.8})`,"zoom-out":`scaleX(${t?1:1.2}) scaleY(${t?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:t=>t.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,c,d,h,u,m){const p=r;return u.isShow?(e(),s(p,{key:0,ref:"ani",animation:u.animationData,class:a(d.customClass),style:n(m.transformStyles),onClick:m.onClick},{default:i((()=>[o(t.$slots,"default")])),_:3},8,["animation","class","style","onClick"])):l("",!0)}]]);const Y=j({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const t={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(e=>{if(this.disable)return;const s=Object.keys(t).find((s=>{const i=e.key,o=t[s];return o===i||Array.isArray(o)&&o.includes(i)}));s&&setTimeout((()=>{this.$emit(s,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"}},watch:{type:{handler:function(t){this.config[t]&&this[this.config[t]](!0)},immediate:!0},isDesktop:{handler:function(t){this.config[t]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(t){this.mkclick=t},immediate:!0},isMaskClick:{handler:function(t){this.mkclick=t},immediate:!0},showPopup(t){document.getElementsByTagName("body")[0].style.overflow=t?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:this.isDesktop?"fixforpc-top":"top"}},computed:{isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:t,windowHeight:e,windowTop:s,safeArea:i,screenHeight:o,safeAreaInsets:a}=u();this.popupWidth=t,this.popupHeight=e+(s||0),i&&this.safeArea?this.safeAreaInsets=a.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(){document.getElementsByTagName("body")[0].style.overflow="visible"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(t){t.stopPropagation(),this.clearPropagation=!0},open(t){this.showPopup&&(clearTimeout(this.timer),this.showPopup=!1);t&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(t)||(t=this.type),this.config[t]?(this[this.config[t]](),this.$emit("change",{show:!0,type:t})):console.error("缺少类型：",t)},close(t){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(t){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(t){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg},t||(this.showPopup=!0,this.showTrans=!0)},center(t){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center"},t||(this.showPopup=!0,this.showTrans=!0)},left(t){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)},right(t){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,display:"flex",flexDirection:"column"},t||(this.showPopup=!0,this.showTrans=!0)}}},[["render",function(t,u,m,p,f,k){const g=V(c("uni-transition"),X),y=r,T=d("keypress");return f.showPopup?(e(),s(y,{key:0,class:a(["uni-popup",[f.popupstyle,k.isDesktop?"fixforpc-z-index":""]])},{default:i((()=>[h(y,{onTouchstart:k.touchstart},{default:i((()=>[f.maskShow?(e(),s(g,{key:"1",name:"mask","mode-class":"fade",styles:f.maskClass,duration:f.duration,show:f.showTrans,onClick:k.onTap},null,8,["styles","duration","show","onClick"])):l("",!0),h(g,{key:"2","mode-class":f.ani,name:"content",styles:f.transClass,duration:f.duration,show:f.showTrans,onClick:k.onTap},{default:i((()=>[h(y,{class:a(["uni-popup__wrapper",[f.popupstyle]]),style:n({backgroundColor:k.bg}),onClick:k.clear},{default:i((()=>[o(t.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick"])])),_:3},8,["onTouchstart"]),f.maskShow?(e(),s(T,{key:0,onEsc:k.onTap},null,8,["onEsc"])):l("",!0)])),_:3},8,["class"])):l("",!0)}],["__scopeId","data-v-44e94237"]]);const W=j({name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0}},created(){this.firstChildAppend=!1},methods:{loadMore(t){this.$emit("scrolltolower")}}},[["render",function(t,a,n,c,d,h){const u=r;return e(),s(u,{class:"uni-list uni-border-top-bottom"},{default:i((()=>[n.border?(e(),s(u,{key:0,class:"uni-list--border-top"})):l("",!0),o(t.$slots,"default",{},void 0,!0),n.border?(e(),s(u,{key:1,class:"uni-list--border-bottom"})):l("",!0)])),_:3})}],["__scopeId","data-v-fbd5ef3c"]]);let q=null;const G=j({components:{chatItem:j({emits:["tryagin","longpressItem"],name:"chat-item",components:{openTool:j({data:()=>({show:!1,animationData:{}}),props:{data:{type:[Object,String]},talkTo:{type:[Object,String,Number]},itemKey:{type:[Object,String,Number]},list:{type:Array,default:()=>[{}]}},onShow(){},computed:{},mounted(){var e=t({duration:300,timingFunction:"linear"});this.animation=e},methods:{copyText(t){m({data:t,success:function(){p({title:"复制成功",icon:"none",position:"bottom"})}})},shoucang(){this.$http.request({url:"/collect/add",method:"POST",data:JSON.stringify({collectType:this.data.msgType,content:this.data.content}),success:t=>{200==t.data.code&&p({title:"收藏成功",icon:"none"})}})},shanchu(){this.$store.dispatch("getchatDatalist"),this.$store.dispatch("getChatList");var t=this.$store.state.chatDatalist[this.talkTo.userId].list,e=this.$store.state.chatlist[this.talkTo.userId];this.itemKey+1==t.length&&(e.content="",this.$store.dispatch("updateChatListInfoById",{userId:this.talkTo.userId,data:e})),t.splice(this.itemKey,1),this.$store.dispatch("updateChatById",{userId:this.talkTo.userId,data:t})},showAnimation(){this.animation.opacity(1).step(),this.animationData=this.animation.export()},hideAnimation(){this.animation.opacity(0).step(),this.animationData=this.animation.export()},moveHandle(t){this.hiddenTab()},showTab(){this.show=!0,setTimeout((()=>{this.showAnimation()}),30)},hiddenTab(){this.show=!1,this.hideAnimation()}}},[["render",function(t,o,n,c,d,u){const m=r;return d.show?(e(),s(m,{key:0,class:a(["openTool",0==n.itemKey?"frist-openTool":""]),onTouchmove:o[1]||(o[1]=k((t=>u.moveHandle("touchmove")),["stop","prevent"])),onClick:o[2]||(o[2]=t=>u.moveHandle("click"))},{default:i((()=>[h(m,{class:"openTool-wx",animation:d.animationData},{default:i((()=>[n.data?(e(),s(m,{key:0,class:"openTool-wx-list"},{default:i((()=>["TEXT"==n.data.msgType?(e(),s(m,{key:0,class:"openTool-wx-list-item",onClick:o[0]||(o[0]=t=>u.copyText(n.data.content))},{default:i((()=>[h(m,{class:"openTool-wx-list-item-icon"},{default:i((()=>[h(m,{class:"wxfont wxcopy"})])),_:1}),h(m,{class:"text"},{default:i((()=>[f("复制")])),_:1})])),_:1})):l("",!0),"TRTC_VOICE_END"!==n.data.msgType&&"TRTC_VIDEO_END"!==n.data.msgType?(e(),s(m,{key:1,class:"openTool-wx-list-item",onClick:u.shoucang},{default:i((()=>[h(m,{class:"openTool-wx-list-item-icon"},{default:i((()=>[h(m,{class:"wxfont shoucang"})])),_:1}),h(m,{class:"text"},{default:i((()=>[f("收藏")])),_:1})])),_:1},8,["onClick"])):l("",!0),h(m,{class:"openTool-wx-list-item",onClick:u.shanchu},{default:i((()=>[h(m,{class:"openTool-wx-list-item-icon"},{default:i((()=>[h(m,{class:"wxfont wxdelete"})])),_:1}),h(m,{class:"text"},{default:i((()=>[f("删除")])),_:1})])),_:1},8,["onClick"])])),_:1})):l("",!0),h(m,{class:"openTool-wx-icon"})])),_:1},8,["animation"]),h(m,{class:"openTool-wx-model"})])),_:1},8,["class"])):l("",!0)}],["__scopeId","data-v-e48c2951"]])},props:{item:{type:Object,default:{}},talkTo:{type:Object,default:{}},itemKey:{type:Number},longTapItemKey:{type:[Number,String],default:""}},watch:{longTapItemKey(t){this.itemKey==t&&this.$refs["toolx"+t].showTab()}},data:()=>({innerAudioContext:"",paused:!1,showTrs:!1}),methods:{sendVoiceCall(){g({title:"发起语音通话"});var t={userId:this.talkTo.userId,msgType:"TRTC_VOICE_START",content:"TRTC_VOICE_START"};this.$http.request({url:"/chat/sendMsg",method:"POST",data:JSON.stringify(t),success:t=>{if("200"==t.data.code){if("0"!==t.data.data.status)return void p({title:t.data.data.statusLabel,icon:"none"});var e=t.data.data.userInfo,s={userId:e.userId,trtcId:e.trtcId,nickName:e.nickName,portrait:e.portrait,startTime:(new Date).getTime(),type:"audio"};y({key:"call",data:JSON.stringify(s),success:function(){console.log("success"),TUICalling.call({userID:e.trtcId,type:1})}})}}})},sendVideoCall(){g({title:"发起视频通话"});var t={userId:this.talkTo.userId,msgType:"TRTC_VIDEO_START",content:"TRTC_VIDEO_START"};this.$http.request({url:"/chat/sendMsg",method:"POST",data:JSON.stringify(t),success:t=>{if("200"==t.data.code){if("0"!==t.data.data.status)return void p({title:t.data.data.statusLabel,icon:"none"});var e=t.data.data.userInfo,s={userId:e.userId,trtcId:e.trtcId,nickName:e.nickName,portrait:e.portrait,startTime:(new Date).getTime(),type:"video"};y({key:"call",data:JSON.stringify(s),success:function(){console.log("success"),TUICalling.call({userID:e.trtcId,type:2})}})}}})},goAddfriend(t){T({url:"../personInfo/detail?param="+t.userId+"&source=2"})},openVideo(t){this.$fc.plusDownload({onlinePath:t}).then((t=>{this.$fc.plusOpenFile({filePath:t})}))},playVOICE(t){if(this.showTrs=!1,this.paused)return this.innerAudioContext.destroy(),void(this.paused=!this.paused);this.innerAudioContext=w(),this.innerAudioContext.sessionCategory="soloAmbient",this.innerAudioContext.src=t,this.innerAudioContext.play(),this.innerAudioContext.onPlay((()=>{this.paused=!0})),this.innerAudioContext.onPause((()=>{this.paused=!1,this.innerAudioContext.destroy()}))},goMap(t){C({latitude:t.latitude,longitude:t.longitude,success:function(){}})},returnParse:t=>JSON.parse(t),tryagin(t,e){this.$emit("tryagin",t,e)},gochatOne(t){var e="GROUP"==t.windowType?"7":"3";T({url:"../personInfo/detail?param="+t.personId+"&source="+e})},longpressItem(t,e,s){console.log(t),this.$emit("longpressItem",t,e,s),this.itemKey==this.longTapItemKey&&this.$refs["toolx"+this.itemKey].showTab()},timeDetia:function(t){var e=new Date(t),s=new Date;e.getTime();var i=e.getHours(),o=e.getMinutes(),a=e.getFullYear(),n=e.getMonth()+1,l=e.getDate();s.getTime(),s.getHours(),s.getMinutes();var r=s.getFullYear(),c=s.getMonth()+1,d=s.getDate();return l==d&&n==c&&a==r?(i<10&&(i="0"+i),o<10&&(o="0"+o),i+":"+o):l+1==d&&n==c&&a==r?(i<10&&(i="0"+i),o<10&&(o="0"+o),"昨天 "+i+":"+o):(n<10&&(n="0"+n),l<10&&(l="0"+l),i<10&&(i="0"+i),o<10&&(o="0"+o),a+"年"+n+"月"+l+"日 "+i+":"+o)}}},[["render",function(t,o,n,c,u,m){const p=d("openTool"),k=r,g=I,y=_;return e(),s(k,{class:a(["zfb-tk-item",[{"zfb-tk-msgleft":1==n.item.type},{"zfb-tk-msgright":2==n.item.type},{"zfb-tk-msgcenter":3==n.item.type}]])},{default:i((()=>[h(p,{class:a([{"openTool-msgleft":1==n.item.type},{"openTool-msgright":2==n.item.type}]),talkTo:n.talkTo,ref:"toolx"+n.itemKey,data:n.item,itemKey:n.itemKey},null,8,["class","talkTo","data","itemKey"]),h(k,{class:"zfb-tk-nick-name"},{default:i((()=>[f(b(n.item.nickName),1)])),_:1}),3!==n.item.type?(e(),s(g,{key:0,class:"zfb-tk-avatar",onClick:o[0]||(o[0]=t=>m.gochatOne(n.item)),src:n.item.portrait,mode:"aspectFill"},null,8,["src"])):l("",!0),h(k,{class:"zfb-tk-item-contentx",onLongpress:o[8]||(o[8]=t=>m.longpressItem(t,n.itemKey,n.item))},{default:i((()=>[h(k,{class:"zfb-tk-item-contentx-c"},{default:i((()=>[n.item.sendtype&&"error"==n.item.sendtype?(e(),s(k,{key:0,class:"zfb-tk-time-notsend wxfont fssb",onClick:o[1]||(o[1]=t=>m.tryagin(n.item,n.itemKey))})):l("",!0),h(k,{class:"zfb-tk-item-contentx-c-tool"},{default:i((()=>["TEXT"==n.item.msgType?(e(),s(k,{key:0,class:"zfb-tk-item-c"},{default:i((()=>[h(y,null,{default:i((()=>[f(b(n.item.content),1)])),_:1})])),_:1})):l("",!0),"ALERT"==n.item.msgType?(e(),s(k,{key:1,class:"zfb-tk-item-c"},{default:i((()=>[h(y,null,{default:i((()=>[f(b(n.item.content),1)])),_:1})])),_:1})):l("",!0),"LOCATION"==n.item.msgType?(e(),s(k,{key:2,class:"zfb-tk-item-c-LOCATION",onClick:o[2]||(o[2]=t=>m.goMap(m.returnParse(n.item.content)))},{default:i((()=>[h(k,{class:"zfb-tk-item-c-LOCATION-name"},{default:i((()=>[f(b(m.returnParse(n.item.content).name),1)])),_:1}),h(k,{class:"zfb-tk-item-c-LOCATION-address"},{default:i((()=>[f(b(m.returnParse(n.item.content).address),1)])),_:1}),h(g,{class:"zfb-tk-item-c-LOCATION-map",src:M,mode:"aspectFit"})])),_:1})):l("",!0),"IMAGE"==n.item.msgType?(e(),s(g,{key:3,class:"zfb-tk-item-c-img",src:m.returnParse(n.item.content).url,mode:"aspectFill",onClick:o[3]||(o[3]=e=>t.$fc.previewImagesolo(m.returnParse(n.item.content).url))},null,8,["src"])):l("",!0),"VOICE"==n.item.msgType?(e(),s(k,{key:4,class:"zfb-tk-item-c-VOICE"},{default:i((()=>[h(k,{class:"zfb-tk-item-c-VOICE-msg"},{default:i((()=>[h(k,{class:"zfb-tk-item-c-VOICE-tras",onClick:o[4]||(o[4]=t=>u.showTrs=!u.showTrs)},{default:i((()=>[h(y,null,{default:i((()=>[f("转文字")])),_:1})])),_:1}),h(k,{class:"zfb-tk-item-c",onClick:o[5]||(o[5]=t=>m.playVOICE(m.returnParse(n.item.content).url))},{default:i((()=>[h(y,null,{default:i((()=>[f(b(m.returnParse(n.item.content).time),1)])),_:1}),h(y,{class:a(["wxfont yuyin",{vmove:u.paused}])},null,8,["class"])])),_:1})])),_:1})])),_:1})):l("",!0),"TRTC_VOICE_END"==n.item.msgType?(e(),s(k,{key:5,class:"zfb-tk-item-c-TRTC_VOICE_END",onClick:m.sendVoiceCall},{default:i((()=>[h(k,{class:"zfb-tk-TRTC zfb-tk-item-c"},{default:i((()=>[h(k,{class:"wxfont yuyin3"}),h(y,null,{default:i((()=>[f("语音通话 时长"+b(n.item.content),1)])),_:1})])),_:1})])),_:1},8,["onClick"])):l("",!0),"TRTC_VIDEO_END"==n.item.msgType?(e(),s(k,{key:6,class:"zfb-tk-item-c-TRTC_VIDEO_END",onClick:m.sendVideoCall},{default:i((()=>[h(k,{class:"zfb-tk-TRTC zfb-tk-item-c"},{default:i((()=>[h(k,{class:"wxfont shipin"}),h(y,null,{default:i((()=>[f("视频通话 时长"+b(n.item.content),1)])),_:1})])),_:1})])),_:1},8,["onClick"])):l("",!0),"VIDEO"==n.item.msgType?(e(),s(k,{key:7,class:"zfb-tk-item-c-video",onClick:o[6]||(o[6]=t=>m.openVideo(m.returnParse(n.item.content).videoUrl))},{default:i((()=>[h(g,{class:"zfb-tk-item-c-img",src:m.returnParse(n.item.content).url,mode:"aspectFill"},null,8,["src"]),h(k,{class:"zfb-tk-item-c-video-icon"},{default:i((()=>[h(y,{class:"wxfont bofang"})])),_:1})])),_:1})):l("",!0),"CARD"==n.item.msgType?(e(),s(k,{key:8,class:"zfb-tk-item-c-CARD",onClick:o[7]||(o[7]=t=>m.goAddfriend(m.returnParse(n.item.content)))},{default:i((()=>[h(k,{class:"zfb-tk-item-c-CARD-top"},{default:i((()=>[h(g,{class:"zfb-tk-item-c-CARD-top-img",src:m.returnParse(n.item.content).avatar,mode:""},null,8,["src"]),h(k,{class:"zfb-tk-item-c-CARD-top-content"},{default:i((()=>[h(k,{class:"zfb-tk-item-c-CARD-title"},{default:i((()=>[f(b(m.returnParse(n.item.content).name),1)])),_:1}),h(k,{class:"zfb-tk-item-c-CARD-no"},{default:i((()=>[f(b(m.returnParse(n.item.content).chatNo),1)])),_:1})])),_:1})])),_:1}),h(k,{class:"zfb-tk-item-c-CARD-card"},{default:i((()=>[f("推荐名片")])),_:1})])),_:1})):l("",!0),u.showTrs?(e(),s(k,{key:9,class:"zfb-tk-item-c-VOICE-tras-text"},{default:i((()=>[f(b(m.returnParse(n.item.content).text),1)])),_:1})):l("",!0),n.item.time?(e(),s(k,{key:10,class:"zfb-tk-time"},{default:i((()=>[f(b(m.timeDetia(n.item.time)),1)])),_:1})):l("",!0)])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-8fd154ed"]]),sendCard:j({emits:["click"],data:()=>({list:[],path:""}),mounted(){this.getflist()},methods:{bindClick(t){this.$emit("click",t)},getflist(){this.$http.request({url:"/friend/friendList",method:"POST",data:JSON.stringify({}),success:t=>{if(200==t.data.code){for(var e=t.data.data,s=[],i=0;i<e.length;i++){var o=e[i];s.push({name:o.nickName,avatar:o.portrait,userId:o.userId,chatNo:o.chatNo})}this.list=this.$fc.sortList({list:s,key:"name"})}}})}}},[["render",function(t,o,a,n,l,d){const u=V(c("watermark"),L),m=V(c("uni-indexed-list-wx"),K),p=r;return e(),s(p,{class:"xw-book"},{default:i((()=>[h(u),h(m,{showAdd:!1,options:l.list,onClick:d.bindClick},null,8,["options","onClick"])])),_:1})}]]),favorites:H},data:()=>({isBottomHeight:"",clickToSubmitSure:null,autodown:!0,emojilist:["😁","😂","😃","😄","😅","😆","😉","😊","😋","😌","😍","😏","😒","😓","😔","😖","😘","😚","😜","😝","😞","😠","😡","😢","😣","😤","😥","😨","😩","😪","😫","😭","😰","😱","😲","😳","😵","😷","😸","😹","😺","😻","😼","😽","😾","😿","🙀","🙅","🙆","🙇","🙈","🙉","🙊","🙋","🙌","🙍","🙎","🙏"],showRecorder:!1,showVice:!1,toolist:[{title:"相册",icon:"tupian"},{title:"拍摄",icon:"xiangji"},{title:"位置",icon:"dingwei"},{title:"语音",icon:"yrecord"},{title:"名片",icon:"mingpian"},{title:"收藏",icon:"shoucang"}],msgFocus:!1,showtool:!1,showEmojitool:!1,msg:"",timer:"",talkTo:"",keyboardHeight:0,windowHeight:0,longTapItemKey:"",localData:{},showtitleNViewBtns:!0}),computed:{userinfo(){return this.$store.state.userInfo},chatListInfo(){return this.$store.state.chatlist[this.talkTo.userId]},chatDataState(){return this.$store.state.chatDataState},chatDataUserId(){return this.$store.state.chatDataUserId},chatWindowData(){if(this.$store.dispatch("getchatDatalist"),this.$store.state.chatDatalist[this.talkTo.userId])return this.$store.state.chatDatalist[this.talkTo.userId].list}},watch:{chatDataState:{deep:!0,immediate:!0,handler(t){this.chatDataUserId==this.talkTo.userId&&(this.scrolltoBottom(),this.clickToSubmitSure())}},keyboardHeight:{deep:!0,immediate:!0,handler(t){t>0&&(this.showEmojitool=!1)}}},onLoad(t){var e=decodeURIComponent(t.data),s=JSON.parse(e);this.talkTo=s,this.$store.commit("update_TalkToData",this.talkTo),this.$store.dispatch("createChatObj",{userId:this.talkTo.userId,windowType:this.talkTo.windowType}).then((t=>{this.localData=t.data,"SINGLE"==s.windowType&&x({title:this.localData.fromInfo.nickName}),this.$store.dispatch("getchatDatalist"),this.$store.dispatch("getChatList"),this.localData.fromInfo&&"normal"==this.localData.fromInfo.userType?this.toolist.push({title:"音视频",icon:"yspin"}):(this.$fc.setTitleNViewBtns(0,""),this.showtitleNViewBtns=!1),this.localData.groupInfo&&this.localData.groupInfo.userId&&(this.$fc.setTitleNViewBtns(0,""),this.showtitleNViewBtns=!0),this.scrolltoBottom()})),this.clickToSubmitSure=this.$fc.debounce((()=>{q=D(this),q.relativeTo(".zfb-tk-main").observe(".autodownView",(t=>{var e=t.intersectionRect.top+t.intersectionRect.height;this.isBottomHeight||(this.isBottomHeight=t.relativeRect.height+t.relativeRect.top-56),parseInt(e)<parseInt(this.isBottomHeight)+40?this.autodown=!0:this.autodown=!1}))}),100,!1)},onPageScroll(){this.clickToSubmitSure()},onReady(){},onShow(){this.chatListInfo&&this.chatListInfo.nickName&&x({title:this.chatListInfo.nickName})},mounted(){},onUnload(){q&&q.disconnect(),this.chatListInfo&&(this.chatListInfo.num=0,this.$store.dispatch("updateChatListInfoById",{userId:this.talkTo.userId,data:this.chatListInfo}))},methods:{addMsg(t){this.msg+=t},clickitem(t,e){this.sendMsg(t.content,t.collectType),this.closepopup("popupfavorites")},longpressItem(t,e){this.longTapItemKey=e},startRecord(){this.$refs.rec.startRecord(),this.showRecorder=!0},endRecord(){this.$refs.rec.stopRecord()},recorderStop(t){g({title:"发送中"}),this.$http.uploadFile({url:"/file/uploadAudio",filePath:t.recordFilePath,name:"file",fileType:"audio",success:e=>{var s=JSON.parse(e.data);if(200==s.code){var i={time:t.recordTime,url:s.data.fullPath,text:s.data.sourceText};this.sendMsg(JSON.stringify(i),"VOICE")}}}),this.$refs.rec.clear(),this.showRecorder=!1},changeShowVice(){this.showVice=!this.showVice},upLoadoneComplete(t){this.sendMsg(JSON.stringify(t),t.type)},upLoadallComplete(t){},changeEmojiTool(){this.showEmojitool=!this.showEmojitool,this.showtool=!1},changeTool(){this.showtool=!this.showtool,this.showEmojitool=!1},sendCardclick(t){this.$refs.popup.close(),this.sendMsg(JSON.stringify(t.item.data),"CARD")},open(){S({success:t=>{this.windowHeight=t.windowHeight}}),this.$refs.popup.open("top")},closepopup(t){this.$refs[t].close()},openpopup(t){this.$refs[t].open("top")},tryagin(t,e){this.chatWindowData.splice(e,1),this.chatWindowData.splice(e,1),this.$store.dispatch("updateChatById",{userId:this.talkTo.userId,data:this.chatWindowData}),this.$nextTick((()=>{this.sendMsg(t.content,t.msgType)}))},sendVoiceCall(){g({title:"发起语音通话"});var t={userId:this.talkTo.userId,msgType:"TRTC_VOICE_START",content:"TRTC_VOICE_START"};this.$http.request({url:"/chat/sendMsg",method:"POST",data:JSON.stringify(t),success:t=>{if("200"==t.data.code){if("0"!==t.data.data.status)return void p({title:t.data.data.statusLabel,icon:"none"});var e=t.data.data.userInfo,s={userId:e.userId,trtcId:e.trtcId,nickName:e.nickName,portrait:e.portrait,startTime:(new Date).getTime(),type:"audio"};y({key:"call",data:JSON.stringify(s),success:function(){TUICalling.call({userID:e.trtcId,type:1})}})}}})},sendVideoCall(){g({title:"发起视频通话"});var t={userId:this.talkTo.userId,msgType:"TRTC_VIDEO_START",content:"TRTC_VIDEO_START"};this.$http.request({url:"/chat/sendMsg",method:"POST",data:JSON.stringify(t),success:t=>{if("200"==t.data.code){if("0"!==t.data.data.status)return void p({title:t.data.data.statusLabel,icon:"none"});var e=t.data.data.userInfo,s={userId:e.userId,trtcId:e.trtcId,nickName:e.nickName,portrait:e.portrait,startTime:(new Date).getTime(),type:"video"};y({key:"call",data:JSON.stringify(s),success:function(){TUICalling.call({userID:e.trtcId,type:2})}})}}})},toolClick(t){switch(t.title){case"位置":O({success:t=>{this.sendMsg(JSON.stringify(t),"LOCATION")}});break;case"相册":this.$refs.upload.chooseTap();break;case"语音":this.startRecord();break;case"名片":this.open();break;case"音视频":$({itemList:["视频通话","语音通话"],success:t=>{switch(t.tapIndex){case 0:this.sendVideoCall();break;case 1:this.sendVoiceCall()}}});break;case"收藏":this.openpopup("popupfavorites"),S({success:t=>{this.windowHeight=t.windowHeight}})}},sendMsg(t,e){t&&(this.$fc.pushOutMsg({msgContent:t,msgType:e,windowType:this.talkTo.windowType,userId:this.talkTo.userId}),this.msg="",this.msgFocus=!1,this.$nextTick((()=>{this.msgFocus=!0})))},startRecognize(){p({title:"H5暂不支持",icon:"none"})},scrolltoBottom(){this.autodown&&this.$nextTick((()=>{this.timer=setTimeout((()=>{v({scrollTop:9999999,duration:10})}),200)}))}},onNavigationBarButtonTap(t){if(this.showtitleNViewBtns&&0===t.index)"GROUP"==this.talkTo.windowType&&A({url:"../groupInfo/detail?param="+this.talkTo.userId}),"SINGLE"==this.talkTo.windowType&&A({url:"../personInfo/detail?param="+this.talkTo.userId})}},[["render",function(t,o,u,m,p,g){const y=V(c("watermark"),L),T=d("sendCard"),w=r,C=V(c("uni-popup"),Y),I=d("favorites"),_=R,x=d("chatItem"),D=V(c("uni-list"),W),S=P,$=V(c("zmm-upload-image"),B);return e(),s(w,null,{default:i((()=>[h(y),h(C,{ref:"popup",type:"center"},{default:i((()=>[h(w,{class:"popsendCard",style:n("height:"+p.windowHeight+"px")},{default:i((()=>[h(T,{onClick:g.sendCardclick},null,8,["onClick"])])),_:1},8,["style"])])),_:1},512),h(C,{ref:"popupfavorites",type:"center","background-color":"#fff",style:{"background-color":"#fff"}},{default:i((()=>[h(_,{"scroll-y":"",style:n("height:"+p.windowHeight+"px")},{default:i((()=>[h(I,{type:"2",onClickitem:g.clickitem},null,8,["onClickitem"])])),_:1},8,["style"])])),_:1},512),h(w,{class:"zfb-tk-main"},{default:i((()=>[h(D,{class:"zfb-tk-conent",border:!1,style:{background:"none"}},{default:i((()=>[(e(!0),z(E,null,N(g.chatWindowData,((t,i)=>(e(),s(x,{key:"key"+i,talkTo:p.talkTo,itemKey:i,item:t,onTryagin:g.tryagin,onLongpressItem:g.longpressItem,longTapItemKey:p.longTapItemKey},null,8,["talkTo","itemKey","item","onTryagin","onLongpressItem","longTapItemKey"])))),128))])),_:1}),h(w,{class:"autodownView"})])),_:1}),h(w,{style:n("height: "+p.keyboardHeight+"px")},null,8,["style"]),p.showtool||p.showEmojitool?(e(),s(w,{key:0,style:"height:558rpx"})):l("",!0),h(w,{class:"zfb-tk-send-tool",style:n("transform: translateY(-"+p.keyboardHeight+"px)")},{default:i((()=>[h(w,{class:"zfb-tk-send-tool-c"},{default:i((()=>[h(w,{class:a(["zfb-tk-send-tool-icon wxfont",p.showVice?"jianpan":"yuyin2"]),onClick:g.changeShowVice},null,8,["onClick","class"]),p.showVice?(e(),s(w,{key:0,class:"zfb-tk-send-tool-vioce"},{default:i((()=>[h(w,{class:"zfb-tk-send-tool-vioce-item",onLongpress:g.startRecord,onTouchend:g.endRecord},{default:i((()=>[f("按住说话")])),_:1},8,["onLongpress","onTouchend"])])),_:1})):(e(),s(w,{key:1,class:"zfb-tk-send-tool-input-box",onClick:o[3]||(o[3]=t=>p.msgFocus=!0)},{default:i((()=>[h(S,{onFocus:o[0]||(o[0]=t=>p.showtool=!1),focus:p.msgFocus,class:"zfb-tk-send-tool-input","adjust-position":!1,modelValue:p.msg,"onUpdate:modelValue":o[1]||(o[1]=t=>p.msg=t),placeholder:"","hold-keyboard":"","confirm-type":"send",onConfirm:o[2]||(o[2]=t=>g.sendMsg(p.msg,"TEXT")),maxlength:-1,"auto-height":""},null,8,["focus","modelValue"])])),_:1})),h(w,{onClick:g.changeEmojiTool,class:"zfb-tk-send-tool-more wxfont biaoqing"},null,8,["onClick"]),""!==p.msg?(e(),s(w,{key:2,class:"zfb-tk-send-tool-text",onTouchend:o[4]||(o[4]=k((t=>g.sendMsg(p.msg,"TEXT")),["prevent"])),style:n({background:""!==p.msg?"#1BC418":"#F7F7F7",color:""!==p.msg?"#fff":"#ddd","border-color":""!==p.msg?"#1BC418":"#ddd"})},{default:i((()=>[f("发送")])),_:1},8,["style"])):(e(),s(w,{key:3,onClick:g.changeTool,class:"zfb-tk-send-tool-more wxfont gengduo"},null,8,["onClick"]))])),_:1}),p.showtool?(e(),s(w,{key:0,class:"zfb-tk-send-tools"},{default:i((()=>[(e(!0),z(E,null,N(p.toolist,((t,o)=>(e(),s(w,{class:"zfb-tk-send-tools-item",onClick:e=>g.toolClick(t)},{default:i((()=>[h(w,{class:"zfb-tk-send-tools-icon"},{default:i((()=>[h(w,{class:a(["wxfont",t.icon])},null,8,["class"])])),_:2},1024),h(w,{class:"zfb-tk-send-tools-text"},{default:i((()=>[f(b(t.title),1)])),_:2},1024)])),_:2},1032,["onClick"])))),256))])),_:1})):l("",!0),p.showEmojitool?(e(),s(_,{key:1,"scroll-y":!0,class:"wxemojitool"},{default:i((()=>[h(w,{class:"wxemojitool-content"},{default:i((()=>[(e(!0),z(E,null,N(p.emojilist,((t,o)=>(e(),s(w,{class:"wxemojitool-item",onClick:e=>g.addMsg(t),key:o},{default:i((()=>[f(b(t),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):l("",!0)])),_:1},8,["style"]),h($,{chooseType:"chooseMedia",show:!1,ref:"upload",onAllComplete:g.upLoadallComplete,onOneComplete:g.upLoadoneComplete},null,8,["onAllComplete","onOneComplete"])])),_:1})}],["__scopeId","data-v-43b1185d"]]);export{G as default};
