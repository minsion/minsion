import{K as e,s as t,B as s,n as i,F as o,o as l,N as n,P as c,O as r,c as a,w as d,a as u,b as p,t as f,x as h,j as m,y as k,d as g,i as y,k as C,Q as x,p as I,h as _,a3 as v,a4 as T}from"./index-CE7gXyKD.js";import{r as N,_ as b}from"./watermark.Dpp_Cumi.js";import{_ as w}from"./friends-circle-top.DRgmXGvl.js";import{_ as L}from"./bf.BE2RdUDc.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as F}from"./uni-load-more.BYiGPlg5.js";const M=$({data:()=>({keyboardHeight:0,msg:"",msgFocus:!1,toggleMsgBox:!1,showToolIndex:null,chooseUserIndex:null,type:"msg",placeholder:"评论",replydata:""}),props:{content:{type:Array,default:[]}},computed:{userInfo(){return this.$store.state.userInfo}},mounted(){},methods:{replyclick(i,o,l){this.chooseUserIndex=l,"Y"==i.canDeleted?(this.hidenTool(),e({itemList:["复制","删除"],success:e=>{switch(e.tapIndex){case 0:s({data:i.content,success:function(){t({title:"复制成功",icon:"none",position:"bottom"})}});break;case 1:this.$http.request({url:"/topic/removeReply/"+i.replyId,success:e=>{200==e.data.code&&(t({title:"删除成功",icon:"none"}),this.content[l].replyList.splice(o,1))}})}}})):(this.replydata=i,this.type="reply",this.placeholder="回复"+i.nickName,this.$nextTick((()=>{this.toggleMsgBox=!0,this.msgFocus=!0})))},gofriend(e){i({url:"../../wx/personInfo/detail?param="+e.userId})},pimgs(e,t){for(var s=[],i=0;i<e.length;i++)s.push(e[i].url);this.$fc.previewImages(s,t)},goMap(e){o({latitude:e.latitude,longitude:e.longitude,success:function(){}})},openVideo(e){this.$fc.plusDownload({onlinePath:e}).then((e=>{this.$fc.plusOpenFile({filePath:e})}))},returnParse:e=>JSON.parse(e),showTool(e){this.chooseUserIndex=e,this.showToolIndex===e?this.showToolIndex=null:this.showToolIndex=e},comment(e){this.showToolIndex=null,this.type="msg",this.placeholder="评论",this.$nextTick((()=>{this.toggleMsgBox=!0,this.msgFocus=!0}))},zan(e,t){switch(e.like){case"N":this.$http.request({url:"/topic/like/"+e.topicId,success:t=>{if(200==t.data.code){this.hidenTool();var s="N"==e.like?e.like="Y":e.like="N";this.content[this.chooseUserIndex].like=s,this.content[this.chooseUserIndex].likeList.push({userId:this.userInfo.userId,nickName:this.userInfo.nickName,portrait:this.userInfo.portrait})}}});break;case"Y":this.$http.request({url:"/topic/cancelLike/"+e.topicId,success:t=>{if(200==t.data.code){this.hidenTool();var s="N"==e.like?e.like="Y":e.like="N";this.content[this.chooseUserIndex].like=s;var i=this.$fc.arrFindkey({arr:this.content[this.chooseUserIndex].likeList,key:"userId",val:this.userInfo.userId});this.content[this.chooseUserIndex].likeList.splice(i.index,1)}}})}},sendMsg(e){if(e){var t="",s="";"msg"==this.type&&(t=this.content[this.chooseUserIndex].topicId,s="1"),"reply"==this.type&&(t=this.replydata.replyId,s="2"),this.$http.request({url:"/topic/reply",method:"POST",data:JSON.stringify({replyId:t,replyType:s,content:e}),success:e=>{200==e.data.code&&(this.hidenTool(),this.content[this.chooseUserIndex].replyList.push(e.data.data))}}),this.msg=""}},hidenTool(){this.showToolIndex=null,this.toggleMsgBox=!1}}},[["render",function(e,t,s,i,o,_){const v=g,T=y,N=C,b=x,w=I;return l(),n(c,null,[(l(!0),n(c,null,r(s.content,((e,t)=>(l(),a(T,{class:"friendsCircle-content-item",key:t},{default:d((()=>[u(v,{class:"friendsCircle-content-avatar",src:e.avatar,mode:"aspectFill",onClick:t=>_.gofriend(e)},null,8,["src","onClick"]),u(T,{class:"friendsCircle-content-right"},{default:d((()=>[u(T,{class:"friendsCircle-content-nickName",onClick:t=>_.gofriend(e)},{default:d((()=>[p(f(e.nickName),1)])),_:2},1032,["onClick"]),u(T,{class:"friendsCircle-content-text"},{default:d((()=>[p(f(e.text),1)])),_:2},1024),"IMAGE"==e.topicType&&e.files.length>0?(l(),a(T,{key:0,class:"friendsCircle-content-imgs"},{default:d((()=>[(l(!0),n(c,null,r(e.files,((t,s)=>(l(),a(v,{key:s,class:h(["friendsCircle-content-img","fci"+e.files.length]),src:t.url,mode:"aspectFill",onClick:t=>_.pimgs(e.files,s)},null,8,["class","src","onClick"])))),128))])),_:2},1024)):m("",!0),"VIDEO"==e.topicType&&e.files.length>0?(l(),a(T,{key:1,class:"friendsCircle-content-video",onClick:t=>_.openVideo(e.files[0].videoUrl)},{default:d((()=>[u(v,{class:"friendsCircle-content-video-icon",src:L,mode:"aspectFill"}),u(v,{class:"friendsCircle-content-video-img",src:e.files[0].url,mode:"aspectFill"},null,8,["src"])])),_:2},1032,["onClick"])):m("",!0),e.location.name?(l(),a(T,{key:2,class:"friendsCircle-content-location",onClick:t=>_.goMap(e.location)},{default:d((()=>[p(f(e.location.name),1)])),_:2},1032,["onClick"])):m("",!0),u(T,{class:"friendsCircle-content-tools"},{default:d((()=>[u(T,{class:"friendsCircle-content-time"},{default:d((()=>[p(f(e.time),1)])),_:2},1024),u(T,{class:h(["friendsCircle-content-tool",{tabon:t==o.showToolIndex}])},{default:d((()=>[u(T,{class:"wxfont caidan",onClick:e=>_.showTool(t)},null,8,["onClick"]),u(T,{class:"friendsCircle-content-tool-absolute"},{default:d((()=>[u(T,{class:"friendsCircle-popup"},{default:d((()=>[u(T,{class:"friendsCircle-popup-item",onClick:s=>_.zan(e,t)},{default:d((()=>[u(T,{class:"friendsCircle-popup-icon wxfont zan"}),"Y"==e.like?(l(),a(T,{key:0,class:"friendsCircle-popup-text"},{default:d((()=>[p("取消")])),_:1})):(l(),a(T,{key:1,class:"friendsCircle-popup-text"},{default:d((()=>[p("赞")])),_:1}))])),_:2},1032,["onClick"]),u(T,{class:"friendsCircle-popup-item",onClick:t=>_.comment(e)},{default:d((()=>[u(T,{class:"friendsCircle-popup-icon wxfont pinglun"}),u(T,{class:"friendsCircle-popup-text"},{default:d((()=>[p("评论")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),e.likeList&&e.likeList.length>0?(l(),a(T,{key:3,class:"friendsCircle-like"},{default:d((()=>[u(T,{class:"friendsCircle-like-icon wxfont zan"}),(l(!0),n(c,null,r(e.likeList,((e,t)=>(l(),a(N,{class:"friendsCircle-like-text"},{default:d((()=>[p(f(e.nickName),1)])),_:2},1024)))),256))])),_:2},1024)):m("",!0),e.replyList&&e.replyList.length>0?(l(),a(T,{key:4,class:"friendsCircle-comment"},{default:d((()=>[(l(!0),n(c,null,r(e.replyList,((e,s)=>(l(),a(T,{class:"friendsCircle-comment-item",key:s},{default:d((()=>[u(N,{class:"friendsCircle-comment-text",onClick:t=>_.gofriend(e)},{default:d((()=>[p(f(e.nickName),1)])),_:2},1032,["onClick"]),"2"==e.replyType?(l(),a(T,{key:0,class:"friendsCircle-comment-feedback"},{default:d((()=>[p(" 回复 "),u(N,{class:"friendsCircle-comment-text",onClick:t=>_.gofriend(e)},{default:d((()=>[p(f(e.toNickName),1)])),_:2},1032,["onClick"])])),_:2},1024)):m("",!0),e.content?(l(),a(T,{key:1,class:"friendsCircle-comment-content",onClick:i=>_.replyclick(e,s,t)},{default:d((()=>[u(N,null,{default:d((()=>[p(f(e.content),1)])),_:2},1024)])),_:2},1032,["onClick"])):m("",!0)])),_:2},1024)))),128))])),_:2},1024)):m("",!0)])),_:2},1024)])),_:2},1024)))),128)),o.toggleMsgBox?(l(),a(T,{key:0,class:"zfb-tk-send-tool",style:k({bottom:o.keyboardHeight+"px"})},{default:d((()=>[u(w,{onSubmit:t[4]||(t[4]=e=>_.sendMsg(o.msg))},{default:d((()=>[u(T,{class:"zfb-tk-send-tool-c"},{default:d((()=>[u(T,{class:"zfb-tk-send-tool-input-box",onClick:t[2]||(t[2]=e=>o.msgFocus=!0)},{default:d((()=>[u(b,{class:"zfb-tk-send-tool-input","adjust-position":!1,focus:o.msgFocus,modelValue:o.msg,"onUpdate:modelValue":t[0]||(t[0]=e=>o.msg=e),placeholder:o.placeholder,"confirm-type":"send",onConfirm:t[1]||(t[1]=e=>_.sendMsg(o.msg)),"hold-keyboard":"",maxlength:-1,"auto-height":""},null,8,["focus","modelValue","placeholder"])])),_:1}),u(T,{class:"zfb-tk-send-tool-text",onClick:t[3]||(t[3]=e=>_.sendMsg(o.msg)),style:k({background:""!==o.msg?"#1BC418":"#F7F7F7",color:""!==o.msg?"#fff":"#ddd","border-color":""!==o.msg?"#1BC418":"#ddd"})},{default:d((()=>[p("发送")])),_:1},8,["style"])])),_:1})])),_:1})])),_:1},8,["style"])):m("",!0)],64)}],["__scopeId","data-v-c8bdf74a"]]);const P=$({data:()=>({queryParams:{refreshing:!1,status:"more",pageNum:1,pageSize:10},content:[]}),computed:{cover(){return this.$store.state.userInfo.cover?JSON.parse(this.$store.state.userInfo.cover):{type:"img",name:"",url:""}},userInfo(){return this.$store.state.userInfo},topicReply(){return this.$store.state.topicReply}},onLoad(){this.getlist()},methods:{getlist(){this.queryParams.status="loading",this.$fc.loadMore({url:"/topic/topicList?",queryParams:this.queryParams}).then((e=>{if(this.$store.commit("update_topicRed",{}),this.queryParams=e.queryParams,"3"!=e.status){if("0"!=e.status){for(var t=e.list,s=[],i=0;i<t.length;i++){var o=t[i];s.push({userId:o.topic.userId,nickName:o.topic.nickName,avatar:o.topic.portrait,topicId:o.topic.topicId,text:JSON.parse(o.topic.content).content,topicType:o.topic.topicType,files:JSON.parse(o.topic.content).files,location:o.topic.location?JSON.parse(o.topic.location):{},time:o.topic.createTime,like:o.like,likeList:o.likeList,replyList:o.replyList})}"2"==e.status&&(this.content=s),"1"==e.status&&(this.content=this.content.concat(s))}}else this.list=[]}))},userClick(e,t){i({url:"../../wx/friendsCircle/person"})},gomsglist(){i({url:"./msglist"})}},onPageScroll(e){this.$refs.fcli.hidenTool()},onNavigationBarButtonTap(e){if(0===e.index)i({url:"../friendsCircle/sendMsg"})},onPullDownRefresh(){this.queryParams.refreshing=!0,this.getlist()},onReachBottom(){this.getlist()}},[["render",function(e,t,s,i,o,n){const c=N(_("watermark"),b),r=N(_("friends-circle-top"),w),h=g,k=C,x=y,I=N(_("friends-circle-list-item"),M),L=N(_("uni-load-more"),F);return l(),a(x,{class:"friendsCircle"},{default:d((()=>[u(c),u(r,{cover:n.cover,userInfo:n.userInfo,onUserClick:n.userClick},null,8,["cover","userInfo","onUserClick"]),u(x,{class:"friendsCircle-content"},{default:d((()=>[n.topicReply.count&&n.topicReply.count>0?(l(),a(x,{key:0,class:"friendsCircle-msgalert-box",onClick:n.gomsglist},{default:d((()=>[u(x,{class:"friendsCircle-msgalert"},{default:d((()=>[u(h,{class:"friendsCircle-msgalert-img",src:n.topicReply.portrait,mode:"aspectFill"},null,8,["src"]),u(k,{class:"friendsCircle-msgalert-text"},{default:d((()=>[p(f(n.topicReply.count)+"条新消息",1)])),_:1})])),_:1})])),_:1},8,["onClick"])):m("",!0),u(I,{ref:"fcli",content:o.content,"onUpdate:content":t[0]||(t[0]=e=>o.content=e)},null,8,["content"])])),_:1}),v(u(L,{status:o.queryParams.status},null,8,["status"]),[[T,o.content.length>9]])])),_:1})}],["__scopeId","data-v-6ce01cf2"]]);export{P as default};
