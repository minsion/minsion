import{M as e,K as t,s,B as i,n as l,F as n,o as c,N as o,a,w as r,b as d,t as p,c as u,P as f,O as m,x as h,j as k,y as g,d as y,i as C,k as _,Q as I,p as x,U as b,h as T}from"./index-CE7gXyKD.js";import{r as N,_ as w}from"./watermark.Dpp_Cumi.js";import{_ as v}from"./bf.BE2RdUDc.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=L({data(){return{timer:null,placeholder:"评论",keyboardHeight:0,msg:"",type:"msg",replydata:"",msgFocus:!1,tabToolIndex:!1,content:this.detail}},props:{detail:{type:Object}},watch:{detail(e){this.content=e}},computed:{userInfo(){return this.$store.state.userInfo}},mounted(){},methods:{scrolltoBottom(){this.$nextTick((()=>{this.timer=setTimeout((()=>{e({scrollTop:9999999,duration:10}),this.$forceUpdate()}),100)}))},replyclick(e,l){"Y"==e.canDeleted?(this.hidenTool(),t({itemList:["复制","删除"],success:t=>{switch(t.tapIndex){case 0:i({data:e.content,success:function(){s({title:"复制成功",icon:"none",position:"bottom"})}});break;case 1:this.$http.request({url:"/topic/removeReply/"+e.replyId,success:e=>{200==e.data.code&&(s({title:"删除成功",icon:"none"}),this.content.replyList.splice(l,1))}})}}})):(this.replydata=e,this.type="reply",this.placeholder="回复"+e.nickName,this.$nextTick((()=>{this.msgFocus=!0})))},gofriend(e){l({url:"../../wx/personInfo/detail?param="+e.userId})},pimgs(e,t){for(var s=[],i=0;i<e.length;i++)s.push(e[i].url);this.$fc.previewImages(s,t)},goMap(e){n({latitude:e.latitude,longitude:e.longitude,success:function(){}})},openVideo(e){this.$fc.plusDownload({onlinePath:e}).then((e=>{this.$fc.plusOpenFile({filePath:e})}))},tabTool(e){this.tabToolIndex=!this.tabToolIndex},comment(e){this.hidenTool(),this.type="msg",this.placeholder="评论",this.$nextTick((()=>{this.msgFocus=!0}))},zan(e,t){switch(e.like){case"N":this.$http.request({url:"/topic/like/"+e.topicId,success:t=>{if(200==t.data.code){var s="N"==e.like?e.like="Y":e.like="N";this.content.like=s,this.content.likeList.push({userId:this.userInfo.userId,nickName:this.userInfo.nickName,portrait:this.userInfo.portrait})}}});break;case"Y":this.$http.request({url:"/topic/cancelLike/"+e.topicId,success:t=>{if(200==t.data.code){var s="N"==e.like?e.like="Y":e.like="N";this.content.like=s;var i=this.$fc.arrFindkey({arr:this.content.likeList,key:"userId",val:this.userInfo.userId});this.content.likeList.splice(i.index,1)}}})}},sendMsg(e){if(e){var t="",s="";"msg"==this.type&&(t=this.content.topicId,s="1"),"reply"==this.type&&(t=this.replydata.replyId,s="2"),this.$http.request({url:"/topic/reply",method:"POST",data:JSON.stringify({replyId:t,replyType:s,content:e}),success:e=>{200==e.data.code&&(this.content.replyList.push(e.data.data),this.$nextTick((()=>{this.scrolltoBottom()})))}}),this.msg=""}},hidenTool(){this.tabToolIndex=!1}}},[["render",function(e,t,s,i,l,n){const b=y,T=C,N=_,w=I,L=x;return c(),o(f,null,[a(T,{class:"friendsCircle-content-item"},{default:r((()=>[a(b,{class:"friendsCircle-content-avatar",src:l.content.avatar,mode:"aspectFill"},null,8,["src"]),a(T,{class:"friendsCircle-content-right"},{default:r((()=>[a(T,{class:"friendsCircle-content-nikeName"},{default:r((()=>[d(p(l.content.nikeName),1)])),_:1}),a(T,{class:"friendsCircle-content-text"},{default:r((()=>[d(p(l.content.text),1)])),_:1}),"IMAGE"==l.content.topicType&&l.content.files.length>0?(c(),u(T,{key:0,class:"friendsCircle-content-imgs"},{default:r((()=>[(c(!0),o(f,null,m(l.content.files,((e,t)=>(c(),u(b,{key:t,class:h(["friendsCircle-content-img","fci"+l.content.files.length]),src:e.url,mode:"aspectFill",onClick:e=>n.pimgs(l.content.files,t)},null,8,["class","src","onClick"])))),128))])),_:1})):k("",!0),"VIDEO"==l.content.topicType&&l.content.files.length>0?(c(),u(T,{key:1,class:"friendsCircle-content-video",onClick:t[0]||(t[0]=e=>n.openVideo(l.content.files[0].videoUrl))},{default:r((()=>[a(b,{class:"friendsCircle-content-video-icon",src:v,mode:"aspectFill"}),a(b,{class:"friendsCircle-content-video-img",src:l.content.files[0].url,mode:"aspectFill"},null,8,["src"])])),_:1})):k("",!0),l.content.location?(c(),u(T,{key:2,class:"friendsCircle-content-location",onClick:t[1]||(t[1]=e=>n.goMap(l.content.location))},{default:r((()=>[d(p(l.content.location.name),1)])),_:1})):k("",!0),a(T,{class:"friendsCircle-content-tools"},{default:r((()=>[a(T,{class:"friendsCircle-content-time"},{default:r((()=>[d(p(l.content.time),1)])),_:1}),a(T,{class:h(["friendsCircle-content-tool",{tabon:l.tabToolIndex}])},{default:r((()=>[a(T,{class:"wxfont caidan",onClick:t[2]||(t[2]=t=>n.tabTool(e.i))}),a(T,{class:"friendsCircle-content-tool-absolute"},{default:r((()=>[a(T,{class:"friendsCircle-popup"},{default:r((()=>[a(T,{class:"friendsCircle-popup-item",onClick:t[3]||(t[3]=e=>n.zan(l.content))},{default:r((()=>[a(T,{class:"friendsCircle-popup-icon wxfont zan"}),"Y"==l.content.like?(c(),u(T,{key:0,class:"friendsCircle-popup-text"},{default:r((()=>[d("取消")])),_:1})):(c(),u(T,{key:1,class:"friendsCircle-popup-text"},{default:r((()=>[d("赞")])),_:1}))])),_:1}),a(T,{class:"friendsCircle-popup-item",onClick:t[4]||(t[4]=e=>n.comment(l.content))},{default:r((()=>[a(T,{class:"friendsCircle-popup-icon wxfont pinglun"}),a(T,{class:"friendsCircle-popup-text"},{default:r((()=>[d("评论")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),a(T,{class:"friendsCircle-content-item-detail"},{default:r((()=>[l.content.likeList&&l.content.likeList.length>0?(c(),u(T,{key:0,class:"friendsCircle-content-item-detail-item"},{default:r((()=>[a(T,{class:"friendsCircle-like-icon wxfont zan"}),a(T,{class:"friendsCircle-like"},{default:r((()=>[(c(!0),o(f,null,m(l.content.likeList,((e,t)=>(c(),u(b,{class:"friendsCircle-like-img",mode:"aspectFill",src:e.portrait},null,8,["src"])))),256))])),_:1})])),_:1})):k("",!0),l.content.replyList&&l.content.replyList.length>0?(c(),u(T,{key:1,class:"friendsCircle-content-item-detail-item"},{default:r((()=>[a(T,{class:"friendsCircle-comment-icon wxfont pinglun"}),a(T,{class:"friendsCircle-comment"},{default:r((()=>[(c(!0),o(f,null,m(l.content.replyList,((e,t)=>(c(),u(T,{class:"friendsCircle-comment-item",key:t},{default:r((()=>[a(b,{class:"friendsCircle-comment-img",src:e.portrait,mode:"aspectFill"},null,8,["src"]),a(T,{class:"friendsCircle-comment-item-text"},{default:r((()=>[a(T,{class:"friendsCircle-comment-item-name"},{default:r((()=>[a(N,{class:"friendsCircle-comment-text"},{default:r((()=>[d(p(e.nickName),1)])),_:2},1024),a(N,{class:"friendsCircle-comment-item-time"},{default:r((()=>[d(p(e.createTime),1)])),_:2},1024)])),_:2},1024),a(T,{style:{width:"100%"},onClick:s=>n.replyclick(e,t)},{default:r((()=>["2"==e.replyType?(c(),u(T,{key:0,class:"friendsCircle-comment-feedback"},{default:r((()=>[a(N,null,{default:r((()=>[d("回复")])),_:1}),a(N,{class:"friendsCircle-comment-text"},{default:r((()=>[d(p(e.toNickName),1)])),_:2},1024)])),_:2},1024)):k("",!0),a(N,{class:"friendsCircle-comment-textx"},{default:r((()=>[d(p(e.content),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):k("",!0)])),_:1}),a(T,{style:{height:"120rpx"}}),a(T,{class:"zfb-tk-send-tool",style:g({bottom:l.keyboardHeight+"px"})},{default:r((()=>[a(L,{onSubmit:t[9]||(t[9]=e=>n.sendMsg(l.msg))},{default:r((()=>[a(T,{class:"zfb-tk-send-tool-c"},{default:r((()=>[a(T,{class:"zfb-tk-send-tool-input-box",onClick:t[7]||(t[7]=e=>l.msgFocus=!0)},{default:r((()=>[a(w,{class:"zfb-tk-send-tool-input","adjust-position":!1,focus:l.msgFocus,modelValue:l.msg,"onUpdate:modelValue":t[5]||(t[5]=e=>l.msg=e),placeholder:l.placeholder,"confirm-type":"send",onConfirm:t[6]||(t[6]=e=>n.sendMsg(l.msg)),"hold-keyboard":"",maxlength:-1,"auto-height":""},null,8,["focus","modelValue","placeholder"])])),_:1}),a(T,{class:"zfb-tk-send-tool-text",onClick:t[8]||(t[8]=e=>n.sendMsg(l.msg)),style:g({background:""!==l.msg?"#1BC418":"#F7F7F7",color:""!==l.msg?"#fff":"#ddd","border-color":""!==l.msg?"#1BC418":"#ddd"})},{default:r((()=>[d("发送")])),_:1},8,["style"])])),_:1})])),_:1})])),_:1},8,["style"])],64)}],["__scopeId","data-v-fcc2ddc9"]]);const F=L({data:()=>({detail:{},showtitleNViewBtns:!1}),onLoad(e){this.getInfo(e.topicId)},mounted(){this.$fc.setTitleNViewBtns(0,"")},computed:{userInfo(){return this.$store.state.userInfo}},methods:{getInfo(e){this.$http.request({url:"/topic/topicInfo/"+e,success:e=>{if(200==e.data.code){var t=e.data.data,s={canDeleted:this.userInfo.userId==t.topic.userId,userId:t.topic.userId,nickName:t.topic.nickName,avatar:t.topic.portrait,topicId:t.topic.topicId,text:JSON.parse(t.topic.content).content,topicType:t.topic.topicType,files:JSON.parse(t.topic.content).files,location:t.topic.location?JSON.parse(t.topic.location):{},time:t.topic.createTime,like:t.like,likeList:t.likeList,replyList:t.replyList};this.detail=s,this.detail.canDeleted&&(this.showtitleNViewBtns=!0,this.$fc.setTitleNViewBtns(0,""))}}})}},onNavigationBarButtonTap(e){if(this.showtitleNViewBtns&&0===e.index)t({itemList:["删除"],success:e=>{this.$http.request({url:"/topic/removeTopic/"+this.detail.topicId,success:e=>{200==e.data.code&&b({delta:1}).then((e=>{s({title:"删除成功",icon:"none"})}))}}),e.tapIndex},fail:function(e){console.log(e.errMsg)}})}},[["render",function(e,t,s,i,l,n){const o=N(T("watermark"),w),d=N(T("friends-circle-detail"),$),p=C;return c(),u(p,null,{default:r((()=>[a(o),a(d,{detail:l.detail},null,8,["detail"])])),_:1})}],["__scopeId","data-v-0174ebb3"]]);export{F as default};
