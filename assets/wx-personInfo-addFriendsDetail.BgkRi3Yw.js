import{U as t,n as e,K as s,s as a,f as i,D as l,h as r,c as d,w as n,j as c,i as o,o as u,a as p,b as h,t as m,x as y,d as f,k as I}from"./index-CE7gXyKD.js";import{r as k,_ as g}from"./watermark.Dpp_Cumi.js";import{_ as T}from"./tool-list-wx.DlOztQ6t.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-badge.BSmtmuwp.js";import"./uni-icons.tBNBx2EM.js";const w=C({data:()=>({userdetail:"",type:"",detail:"",param:"",list1:[{title:"添加到通讯录",path:"#",icon:""}],list3:[{title:"状态",path:"#",else:[{type:"text",content:""}],hideRight:!0}],list2:[{title:"来源",path:"#",else:[{type:"text",content:""}],hideRight:!0}],list4:[{title:"添加到通讯录",path:"#",icon:""},{title:"拒绝",path:"#",icon:""},{title:"忽略",path:"#",icon:""}],list5:[{title:"发消息",path:"#",icon:"faxiaoxi"},{title:"音视频通话",path:"#",icon:"shipin"}]}),onLoad(t){this.param=t.param,this.type=t.type,"2"==this.type&&this.getApplyInfo(t.param),"1"==this.type&&this.getUser(t.param)},methods:{getApplyInfo(t){this.$http.request({url:"/apply/info/"+t,success:t=>{200==t.data.code&&(this.detail=t.data.data,this.list3[0].else[0].content=this.detail.applyStatusLabel,this.list2[0].else[0].content=this.detail.applySourceLabel,this.getUser(this.detail.chatNo))}})},getUser(e){this.$http.request({url:"/friend/findFriend",method:"POST",data:JSON.stringify({param:e}),success:e=>{200==e.data.code?(this.userdetail=e.data.data,this.userdetail.sourceLabel&&(this.list2[0].else[0].content=this.userdetail.sourceLabel)):t({delta:1})}})},itemClick(t,s){if(0===s)e({url:"../search-friends/add?userId="+this.userdetail.userId+"&source="+this.userdetail.source})},itemClick5(t,a){switch(a){case 0:let t={userId:this.userdetail.userId,windowType:"SINGLE",portrait:this.userdetail.portrait};e({url:"../chatWindow/index?data="+encodeURIComponent(JSON.stringify(t))});break;case 1:s({itemList:["视频通话","语音通话"],success:t=>{switch(t.tapIndex){case 0:this.sendVideoCall();break;case 1:this.sendVoiceCall()}}})}},itemClicklist4(e,s){switch(s){case 0:this.$http.request({url:"/apply/agree",method:"POST",data:JSON.stringify({applyId:this.param}),success:e=>{200==e.data.code&&t({delta:1}).then((t=>{a({title:"已同意",icon:"none"})}))}});break;case 1:this.$http.request({url:"/apply/refused",method:"POST",data:JSON.stringify({applyId:this.param}),success:e=>{200==e.data.code&&t({delta:1}).then((t=>{a({title:"已拒绝",icon:"none"})}))}});break;case 2:this.$http.request({url:"/apply/ignore",method:"POST",data:JSON.stringify({applyId:this.param}),success:e=>{200==e.data.code&&t({delta:1}).then((t=>{a({title:"已忽略",icon:"none"})}))}})}},sendVoiceCall(){i({title:"发起语音通话"});var t={userId:this.userdetail.userId,msgType:"TRTC_VOICE_START",content:"TRTC_VOICE_START"};this.$http.request({url:"/chat/sendMsg",method:"POST",data:JSON.stringify(t),success:t=>{if("200"==t.data.code){if("0"!==t.data.data.status)return void a({title:t.data.data.statusLabel,icon:"none"});var e=t.data.data.userInfo,s={userId:e.userId,trtcId:e.trtcId,nickName:e.nickName,portrait:e.portrait,startTime:(new Date).getTime(),type:"audio"};l({key:"call",data:JSON.stringify(s),success:function(){console.log("success"),TUICalling.call({userID:e.trtcId,type:1})}})}}})},sendVideoCall(){i({title:"发起视频通话"});var t={userId:this.userdetail.userId,msgType:"TRTC_VIDEO_START",content:"TRTC_VIDEO_START"};this.$http.request({url:"/chat/sendMsg",method:"POST",data:JSON.stringify(t),success:t=>{if("200"==t.data.code){if("0"!==t.data.data.status)return void a({title:t.data.data.statusLabel,icon:"none"});var e=t.data.data.userInfo,s={userId:e.userId,trtcId:e.trtcId,nickName:e.nickName,portrait:e.portrait,startTime:(new Date).getTime(),type:"video"};l({key:"call",data:JSON.stringify(s),success:function(){console.log("success"),TUICalling.call({userID:e.trtcId,type:2})}})}}})}}},[["render",function(t,e,s,a,i,l){const C=k(r("watermark"),g),w=f,x=I,S=o,_=k(r("tool-list-wx"),T);return i.userdetail?(u(),d(S,{key:0,class:"bgColor"},{default:n((()=>[p(C),p(S,{class:"person-wx"},{default:n((()=>[p(S,{class:"person-wx-user"},{default:n((()=>[p(w,{class:"person-wx-avatar",onClick:e[0]||(e[0]=e=>t.$fc.previewImagesolo(i.userdetail.portrait)),src:i.userdetail.portrait,mode:"aspectFill"},null,8,["src"]),p(S,{class:"person-wx-user-detail"},{default:n((()=>[p(S,{class:"person-wx-nikename"},{default:n((()=>[p(x,{class:"text"},{default:n((()=>[h(m(i.userdetail.nickName),1)])),_:1}),"0"==i.userdetail.gender?(u(),d(S,{key:0,class:y(["wxfont person-wx-nikename-icon",{nv:"0"==i.userdetail.gender}])},null,8,["class"])):c("",!0),"1"==i.userdetail.gender?(u(),d(S,{key:1,class:y(["wxfont person-wx-nikename-icon",{nan:"1"==i.userdetail.gender}])},null,8,["class"])):c("",!0)])),_:1}),p(x,{class:"person-wx-name"},{default:n((()=>[h(" 微聊号："+m(i.userdetail.chatNo),1)])),_:1}),i.userdetail.provinces?(u(),d(x,{key:0,class:"person-wx-name"},{default:n((()=>[h("地区："+m(i.userdetail.provinces)+" "+m(i.userdetail.city),1)])),_:1})):c("",!0)])),_:1})])),_:1})])),_:1}),p(_,{list:i.list2},null,8,["list"]),"0"!==i.detail.applyStatus&&"2"==i.type?(u(),d(_,{key:0,list:i.list3},null,8,["list"])):c("",!0),"2"==i.type&&"0"==i.detail.applyStatus&&"N"==i.userdetail.isFriend?(u(),d(_,{key:1,list:i.list4,type:"btns",onItemClick:l.itemClicklist4},null,8,["list","onItemClick"])):c("",!0),"1"==i.type&&"N"==i.userdetail.isFriend?(u(),d(_,{key:2,list:i.list1,type:"btns",onItemClick:l.itemClick},null,8,["list","onItemClick"])):c("",!0),"Y"==i.userdetail.isFriend?(u(),d(_,{key:3,list:i.list5,type:"btns",onItemClick:l.itemClick5},null,8,["list","onItemClick"])):c("",!0)])),_:1})):c("",!0)}],["__scopeId","data-v-56e416fc"]]);export{w as default};
